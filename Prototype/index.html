<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Cape Town</title>
    <link href="css/skeleton.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="js/proto.js"></script>
    <style>
        #map {
            height: 400px;
            width: 40%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

    </style>

    <script type = 'text/x-template' class= 'theFilter'>
      <select id = 'forMap'>
        {{#makeDropdown 'filter'}}
          CapeTown
          Khayelitsha
        {{/makeDropdown}}
      </script>
    </script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="twelve columns">
                <h1>Cape Town</h1>
            </div>
        </div>
        <div class = 'row'>
          <div id ='filterPart'></div>
        </div>
        <div class="row">
            <div id="map"></div>
        </div>
        <div class='row'>
            <div class='six columns'>
                <ul>
                    <li><b>Area:</b> <span>2444.97 km²</span></li>
                    <li><b>Population: </b><span>3740026 (1529.68 per km²)</span></li>
                    <li><b>Households: </b><span>1068573 (437.05 per km²)</span></li>
                </ul>
            </div>
            <div class='six columns'>
                <table>
                    <tr>
                        <th>Gender</th>
                        <th>People</th>
                        <th>Percentage</th>
                    </tr>
                    <tr>
                        <td>Female</td>
                        <td>1909327</td>
                        <td>51.05%</td>
                    </tr>
                    <tr>
                        <td>Male</td>
                        <td>1830699</td>
                        <td>48.95%</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class='row'>
            <div class='twelve columns'>
                <div id="piechart"></div>
            </div>
        </div>
        <div class="row">
            <div id="myDiv">
                <!-- TABLE WILL SHOW HERE-->
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    // Load google charts
    google.charts.load('current', {
        'packages': ['corechart']
    });
    google.charts.setOnLoadCallback(drawChart);

    // Draw the chart and set the chart values
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Population ', 'Percentage'],
            ['Coloured', 42.39],
            ['White', 15.66],
            ['Black African', 38.63],
            ['Other', 1.93],
            ['Indian or Asian', 1.38]
        ]);

        // Optional; add a title and set the width and height of the chart
        var options = {
            'title': 'Population Group',
            'width': 750,
            'height': 600
        };

        // Display the chart inside the <div> element with id="piechart"
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }

</script>
    <!---- LANGUAGE TABLE JS -->
<script>
    var trace1 = {
        x: ['Afrikaans', 'English', 'isiXhosa', 'Sesotho', 'isiZulu', 'Setswana', 'Isindebele', 'Xitsonga', 'Sign language', 'Other'],
        y: [54.25, 30.20, 9.28, 0.78, 0.52, 0.39, 0.26, 0.13, 0.13, 4.18],
        type: 'bar',
        text: ['4.17 below the mean', '4.17 below the mean', '0.17 below the mean', '0.17 below the mean', '0.83 above the mean', '7.83 above the mean'],
        marker: {
            color: 'rgb(142,124,195)'
        }
    };

    var data = [trace1];

    var layout = {
        title: 'Languages in Cape town',
        font: {
            family: 'Raleway, sans-serif'
        },
        showlegend: false,
        xaxis: {
            tickangle: -45
        },
        yaxis: {
            zeroline: false,
            gridwidth: 2
        },
        bargap: 0.05
    };

    Plotly.newPlot('myDiv', data, layout);

</script>
<script>
    window.addEventListener('load', function(){

    });
    var selected = document.getElementById('forMap');
    var map;
    var url;
    var thelist = [{CapeTown: "https://census2011.adrianfrith.com/place/199/kml"},{Khayelitsha:"https://census2011.adrianfrith.com/place/199038/kml"}];
    if(selected.options[selected.selectedIndex].value === 'CapeTown'){
        for(var i =0; i< thelist.length; i++){
          url = thelist[i].CapeTown;
          break;
        }
    }
    var map;
    //var thelist = [{CapeTown: "https://census2011.adrianfrith.com/place/199/kml"},{Khayelitsha:"https://census2011.adrianfrith.com/place/199038/kml"}];
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          mapTypeId: google.maps.MapTypeId.HYBRID
        });
        var marker = new google.maps.Marker(
           {position:{lat: 18.58435864, lng: -33.9379211}
         });

        var cptLayer = showCapeTown();
        setTimeout(function(){
          cptLayer.setMap(null);
          showKhayelitsha();
        }, 5000)


    }
    function showCapeTown(){
      var kmllayer = new google.maps.KmlLayer(
        thelist[0].CapeTown,
        {map: map, clickable: false});
        return kmllayer;
    }
    function showKhayelitsha(){
      var kmllayer = new google.maps.KmlLayer(
        thelist[1].Khayelitsha,
        {map: map, clickable: false});
    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCz9g0tAMVgP8bZx5LYtbY1t42Y_nsCTTw&callback=initMap"></script>

</html>
